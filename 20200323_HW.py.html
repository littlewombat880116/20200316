#!/usr/bin/env python
# coding: utf-8

# **用熊貓輸入讀檔案（檔名要英文）**

# In[62]:


import matplotlib.pyplot as plt
import pandas as pd


# In[63]:


df = pd.read_csv('/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv')  


# **合併資料**

# In[64]:


df["Page_Name"] = df["Page_Name"].str.replace("三民惟新 陳柏惟","3Q 陳柏惟")


# # 找出Comment_Count數最多的文章內容

# In[15]:


print(max(df.Comment_Count)) 
print(df[(df['Comment_Count'] == max(df.Comment_Count) )]['Message'])


# # 找出 All_Reaction_Count數最少的文章內容

# In[16]:


print(min(df.All_Reaction_Count)) 
print(df[(df['All_Reaction_Count'] == min(df.All_Reaction_Count) )]['Message'])


# In[17]:


import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np


# # 切割並新增欄位

# In[18]:


print(df['Date'][0])


# In[19]:


df['Date'][0].split("/")[2].split(" ")[1].split(":")


# In[20]:


df['Year'] = df['Date'].apply(lambda x : x.split("/")[0])


# In[21]:


df['Month'] = df['Date'].apply(lambda x : x.split("/")[1])


# In[22]:


df['Hour'] = df['Date'].apply(lambda x : x.split("/")[2].split(" ")[1].split(":")[0])


# # 取出陳柏惟和顏寬恒文章中留言數>500的總讚數，並且畫成bar chart

# In[68]:


likedf = df[((df['Page_Name'] == '3Q 陳柏惟') | (df['Page_Name'] == '顏寬恒')) & (df['Comment_Count'] > 500)].groupby(by ='Page_Name').sum().reset_index().sort_values('All_Reaction_Count')
likedf = likedf.rename(columns={'LIKE_COUNT': '總讚數'})
print(likedf)
print(likedf.columns.values)

import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif']=['SimHei']       
likedf.plot.bar(x='Page_Name', y='總讚數', color=['blue','green'])


# **計算各候選人文章數**

# In[69]:


likedf = df[(df['LIKE_COUNT'] > 1000)].groupby(by ='Page_Name').count().reset_index().sort_values('All_Reaction_Count')
likedf = likedf.rename(columns={'All_Reaction_Count': '文章數'})
print(likedf)
print(likedf.columns.values)
import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif']=['SimHei']

likedf.plot.bar(x='Page_Name', y='文章數')


# # 取出陳柏惟與顏寬恒的總發文數，並且畫成pie chart

# **陳柏惟發文類型**

# In[72]:


import pandas as pd
df = pd.read_csv("/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv")
df.head()
likedf =  df.groupby(['Page_Name','Type']).count().reset_index()
likedf =  likedf[likedf['Page_Name'] == '3Q 陳柏惟']
likedf['Page_ID'] = likedf['Page_ID'].apply(lambda x :x/likedf['Page_ID'].sum())
print(likedf['Page_ID'])
plt.pie(likedf['Page_ID'] , labels = likedf['Type'],autopct='%1.1f%%')


# **顏寬恒發文類型**

# In[73]:


df.head()
likedf =  df.groupby(['Page_Name','Type']).count().reset_index()
likedf =  likedf[likedf['Page_Name'] == '顏寬恒']
likedf['Page_ID'] = likedf['Page_ID'].apply(lambda x :x/likedf['Page_ID'].sum())
print(likedf['Page_ID'])
plt.pie(likedf['Page_ID'] , labels = likedf['Type'],autopct='%1.1f%%')


# 顏寬恆發文類型

# # 請問陳柏惟與顏寬恒的按讚數和留言數有相似的趨勢嗎？

# In[32]:


import pandas as pd
csv_file = "/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv"
df = pd.read_csv(csv_file)

df.head(1)


# **陳柏惟按讚留言趨勢**

# In[33]:


df["Post_Date"] = df["Date"].str.split(" ").str.get(0).str.title() 
df["Hour"] = df["Date"].str.split(" ").str.get(1).str.title().str.split(":").str.get(0)
df.head(1)


# In[34]:


#格式化時間
df['Date'] = pd.to_datetime(df['Date'])
df['Week'] = df['Date'].dt.strftime('%A')
df.head(1)


# In[43]:


#篩選各政黨的資料
df_green = df[(df["Page_Name"] == "3Q 陳柏惟" )]

#一次抓很多筆
like_green = df_green.groupby(df['Date'].dt.strftime('%Y/%m'))['All_Reaction_Count','LIKE_COUNT','WOW_COUNT','HAHA_COUNT','SAD_COUNT','ANGRY_COUNT','Comment_Count','Share_Count'].sum().reset_index()
like_green

#比較按讚數和留言數的數量
like_green.plot(x='Date',y=['LIKE_COUNT','Comment_Count','All_Reaction_Count'])


# **顏寬恒按讚留言趨勢**

# In[100]:


import pandas as pd
csv_file = "/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv"
df = pd.read_csv(csv_file)

df["Post_Date"] = df["Date"].str.split(" ").str.get(0).str.title() 
df["Hour"] = df["Date"].str.split(" ").str.get(1).str.title().str.split(":").str.get(0)
df.head(1)

#格式化時間
df['Date'] = pd.to_datetime(df['Date'])
df['Week'] = df['Date'].dt.strftime('%A')
df.head(1)


# In[101]:


#篩選各政黨的資料
df_blue = df[(df["Page_Name"] == "顏寬恒" )]

#一次抓很多筆
like_blue = df_blue.groupby(df['Date'].dt.strftime('%Y/%m'))['All_Reaction_Count','LIKE_COUNT','WOW_COUNT','HAHA_COUNT','SAD_COUNT','ANGRY_COUNT','Comment_Count','Share_Count'].sum().reset_index()
like_blue

#比較按讚數和留言數的數量
like_blue.plot(x='Date',y=['LIKE_COUNT','Comment_Count','All_Reaction_Count'])


# # 取出候選人的總發文數，並且畫成pie chart

# In[79]:


likedf = df.groupby(by ='Page_Name').count().reset_index().sort_values('All_Reaction_Count')
likedf = likedf.rename(columns={'All_Reaction_Count': '文章數'})
print(likedf)
plt.pie(likedf['文章數'] , labels = likedf['Page_Name'],autopct='%1.1f%%')


# # 請畫出陳柏惟與顏寬恒每天的發文折線圖

# **陳柏惟每天的發文折線圖**

# In[83]:


import pandas as pd
csv_file = "/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv"
df = pd.read_csv(csv_file)

df["Post_Date"] = df["Date"].str.split(" ").str.get(0).str.title() 
#df.head(1)

df["Hour"] = df["Date"].str.split(" ").str.get(1).str.title().str.split(":").str.get(0)
df.head(1)

#格式化時間
df['Date'] = pd.to_datetime(df['Date'])

df['Week'] = df['Date'].dt.strftime('%A')
df.head(1)


# In[84]:


#把每個政黨每天發幾篇文算一次
df_post = df.groupby(['Page_Name','Post_Date'])['LIKE_COUNT'].count().reset_index(name='count')
#注意要加'reset_index(name='count')'才會變成dataframe
#df_post

#把國民黨單獨拿出來
df_gr = df_post[df_post['Page_Name']=='3Q 陳柏惟']
#df_tw = df_post[df_post['Page_Name']=='台灣基進']
#df_green = df_post[df_post['Page_Name']=='民主進步黨']

df_gr


# In[85]:


import matplotlib.ticker as ticker

plt.figure(figsize=(15,4)) #設定圖表大小

plt.title("Number of Post") # 加標題
plt.xlabel("Time")          # 加x軸標題
plt.ylabel("Number of Post")        # 加y軸標題   

plt.plot(df_gr['Post_Date'],df_gr['count'])
plt.gca().xaxis.set_major_locator(ticker.MultipleLocator(40)) #調整x軸要顯示幾個值
plt.show()


# **顏寬恒每天的發文折線圖**

# In[88]:


import pandas as pd
csv_file = "/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv"
df = pd.read_csv(csv_file)

df["Post_Date"] = df["Date"].str.split(" ").str.get(0).str.title() 
#df.head(1)

df["Hour"] = df["Date"].str.split(" ").str.get(1).str.title().str.split(":").str.get(0)
df.head(1)

#格式化時間
df['Date'] = pd.to_datetime(df['Date'])

df['Week'] = df['Date'].dt.strftime('%A')
df.head(1)

#把每個政黨每天發幾篇文算一次
df_post = df.groupby(['Page_Name','Post_Date'])['LIKE_COUNT'].count().reset_index(name='count')
#注意要加'reset_index(name='count')'才會變成dataframe
#df_post

#把國民黨單獨拿出來
df_blue = df_post[df_post['Page_Name']=='顏寬恒']
#df_tw = df_post[df_post['Page_Name']=='台灣基進']
#df_green = df_post[df_post['Page_Name']=='民主進步黨']

df_blue

import matplotlib.ticker as ticker

plt.figure(figsize=(15,4)) #設定圖表大小

plt.title("Number of Post") # 加標題
plt.xlabel("Time")          # 加x軸標題
plt.ylabel("Number of Post")        # 加y軸標題   

plt.plot(df_blue['Post_Date'],df_blue['count'])
plt.gca().xaxis.set_major_locator(ticker.MultipleLocator(40)) #調整x軸要顯示幾個值
plt.show()


# # 畫出陳柏惟與顏寬恒每個月的發文熱圖

# **陳柏惟每個月的發文熱圖**

# In[106]:


#選出3q的發文
df_gr = df[df['Page_Name']=='3Q 陳柏惟']

#算每星期每小時發了幾篇
df_post_gr = df_gr.groupby(['Week','Hour'])['LIKE_COUNT'].count().reset_index(name='count')

df_post_gr


# In[107]:


import matplotlib.pyplot as plt
import seaborn as sns
sns.set()

flights = df_post_gr.pivot("Week", "Hour", "count")
# 畫出x-y-z的圖，比如 年-月-銷量 的熱圖
f, ax = plt.subplots(figsize=(9, 6))
#使用不同的顏色
sns.heatmap(flights, fmt="d",cmap='YlGnBu', ax=ax)
#設置座標字體方向
label_y = ax.get_yticklabels()
plt.setp(label_y, rotation=360, horizontalalignment='right')
label_x = ax.get_xticklabels()
plt.setp(label_x, rotation=45, horizontalalignment='right')
plt.show()


# **顏寬恒每個月的發文熱圖**

# In[108]:


import pandas as pd
csv_file = "/Users/wombat/Desktop/課程筆記/政治與資訊/教學資料/CSV 資料集/10802_2020_tclw.csv"
df = pd.read_csv(csv_file)

df["Post_Date"] = df["Date"].str.split(" ").str.get(0).str.title() 
#df.head(1)

df["Hour"] = df["Date"].str.split(" ").str.get(1).str.title().str.split(":").str.get(0)
df.head(1)

#格式化時間
df['Date'] = pd.to_datetime(df['Date'])

df['Week'] = df['Date'].dt.strftime('%A')
df.head(1)

#選出水餃的發文
df_yan = df[df['Page_Name']=='顏寬恒']

#算每星期每小時發了幾篇
df_post_yan = df_yan.groupby(['Week','Hour'])['LIKE_COUNT'].count().reset_index(name='count')

df_post_yan


# In[109]:


import matplotlib.pyplot as plt
import seaborn as sns
sns.set()

flights = df_post_yan.pivot("Week", "Hour", "count")
# 畫出x-y-z的圖，比如 年-月-銷量 的熱圖
f, ax = plt.subplots(figsize=(9, 6))
#使用不同的顏色
sns.heatmap(flights, fmt="d",cmap='YlGnBu', ax=ax)
#設置座標字體方向
label_y = ax.get_yticklabels()
plt.setp(label_y, rotation=360, horizontalalignment='right')
label_x = ax.get_xticklabels()
plt.setp(label_x, rotation=45, horizontalalignment='right')
plt.show()

